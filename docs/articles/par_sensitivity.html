<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SWATrunR">
<title>Parameter sensitivity analysis • SWATplusR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parameter sensitivity analysis">
<meta property="og:description" content="SWATrunR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SWATplusR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/SWATrunR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/par_sampl_calib.html">Parameter sampling and model calibration</a>
    <a class="dropdown-item" href="../articles/par_sensitivity.html">Parameter sensitivity analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/chrisschuerz/SWATrunR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Parameter sensitivity analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chrisschuerz/SWATrunR/blob/HEAD/vignettes/par_sensitivity.Rmd" class="external-link"><code>vignettes/par_sensitivity.Rmd</code></a></small>
      <div class="d-none name"><code>par_sensitivity.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="aim-of-this-article">Aim of this article<a class="anchor" aria-label="anchor" href="#aim-of-this-article"></a>
</h2>
<p>This article should provide you with some approaches how you can
perform parameter sensitivity analysis with <code>SWATplusR</code> some
of the standard <code>R</code> packages for sensitivity analysis.
Although parameter sensitivity analysis is a wide field with many
different methods available I will focus on a few standard and (still)
state-of-the-art methods for Global Sensitivity Analysis (GSA). This
article will cover the following topics:</p>
<ul>
<li>Introduction into two <code>R</code> packages for sensitivity
analysis; <code>sensitivity</code> <span class="citation">(<a href="#ref-Iooss2018">Iooss et al., 2018</a>)</span> and
<code>sensobol</code> <span class="citation">(<a href="#ref-Puy2022">Puy
et al., 2022</a>)</span>
</li>
<li>Parameter screening with the Morris’ method <span class="citation">(<a href="#ref-Morris1991">Morris,
1991</a>)</span>
</li>
<li>GSA with the VARS <span class="citation">(<a href="#ref-Razavi2016a">Razavi and Gupta, 2016a</a>, <a href="#ref-Razavi2016b">2016b</a>)</span> method</li>
<li>GSA with the Sobol’ method <span class="citation">(<a href="#ref-Sobol1993">Sobol, 1993</a>)</span>, calculation of confidence
intervals for sensitivity estimates</li>
<li>temporal sensitivity analysis with Sobol’ indices</li>
</ul>
</div>
<div class="section level2">
<h2 id="r-packages-for-sensitivity-analysis">
<code>R</code> packages for sensitivity analysis<a class="anchor" aria-label="anchor" href="#r-packages-for-sensitivity-analysis"></a>
</h2>
<p>Several <code>R</code> packages are available that provide widely
used methods for (global) sensitivity analysis. <code>sensitivity</code>
<span class="citation">(<a href="#ref-Iooss2018">Iooss et al.,
2018</a>)</span> for example is a very comprehensive collection of
methods, including the Morris’s “OAT” elementary effects screening
method <span class="citation">(<a href="#ref-Morris1991">Morris,
1991</a>)</span>, different variance-based methods to estimate for
example Sobol’ first order, second order and total indices <span class="citation">(<a href="#ref-Sobol1993">Sobol, 1993</a>)</span>, and
extended-FAST sensitivity indices <span class="citation">(<a href="#ref-Saltelli1999">A. Saltelli, 1999</a>)</span>, or derivative
based methods such as Distributed Evaluation of Local Sensitivity
Analysis (DELSA, <span class="citation">Rakovec et al. (<a href="#ref-Rakovec2014">2014</a>)</span>) , just to mention a few.
Another more recent <code>R</code> package to compute Variance-Based
Sensitivity Indices is <code>sensobol</code> <span class="citation">(<a href="#ref-Puy2022">Puy et al., 2022</a>)</span>. It includes methods
such as the Sobol’ method or VARS <span class="citation">(<a href="#ref-Razavi2016a">Razavi and Gupta, 2016a</a>, <a href="#ref-Razavi2016b">2016b</a>)</span>.</p>
<p>Most methods for sensitivity analysis require scalar model output to
assess the sensitivity of an output variable to changes in the model
inputs. To directly perform a sensitivity analysis on a simulated time
series of a SWAT model output variable the analysis can be performed for
example for each time step (temporal sensitivity analysis), or the
simulated time series is aggregated to a single value before it is used
in the analysis. One way could be to compute average annual values.
Another option is to use any performance measures and calculate e.g. a
goodness-of-fit value in comparison to observation data that is then
used in a sensitivity analysis. The latter approach is the most common
approach to be found in the literature. The <code>hydroGOF</code>
package <span class="citation">(<a href="#ref-MZB2017">Mauricio
Zambrano-Bigiarini, 2017</a>)</span> for example provides a
comprehensive collection of performance measures used in hydrological
model performance assessment (and which you can also use in any
sensitivity analysis).</p>
<p>I personally prefer to perform sensitivity analyses directly on the
simulation outputs, first because it does not require any observation
data and second the analysis shows the direct effect of the simulated
output to changes in e.g. the perturbed model parameters and does not
require a performance metric that may have an emphasis on specific parts
of the time series (e.g. NSE has a stronger weight on peaks).</p>
<p>To learn how you can use <code>R</code> packages for sensitivity
analysis together with <code>SWATplusR</code> I will share a few
examples and different approaches for sensitivity analysis in this
section. At the beginning I will introduce the two packages
<code>sensivitity</code> and <code>sensobol</code> and show how those
can be implemented in a general way. After the introduction we will go
through a simple parameter screening using the Morris’ method. After
that we will learn how to implement VARS and the Sobol’ method for
global sensitivity analysis which are can be considered as more in depth
analysis, which come however with higher computational costs. In the
last example I will show you how you can quickly transform the analysis
with the Sobol’ method into a temporal sensitivity analysis. For the
target variables (model outputs) that I use in the analyses I will
switch between aggregated long term average values and calculated Nash
Sutcliffe Efficiency (NSE, <span class="citation">Nash and Sutcliffe (<a href="#ref-Nash1970">1970</a>)</span>) values as scalar variables to
demonstrate the different possible approaches that you can implement in
your analyses.</p>
<div class="section level3">
<h3 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h3>
<p>If you do not have installed any of the required R package, follow
the instructions for the respective R package. All of the required R
packages are available from CRAN and can be installed with the following
commands:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If any of the packages is not installed already run the respective lines here.</span></span>
<span><span class="co"># General data science packages, plotting etc.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'dplyr'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'tidyr'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'purrr'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'lubridate'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'forcats'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'stringr'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'ggplot2'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"patchwork"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Packages for sensitivity analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'sensitivity'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'sensobol'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Hydrological model performance metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'hydroGOF'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-r-packages">Loading R packages<a class="anchor" aria-label="anchor" href="#loading-r-packages"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># General data science packages, plotting etc.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Packages for sensitivity analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chrisschuerz/SWATplusR" class="external-link">SWATplusR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/arnaldpuy/sensobol" class="external-link">sensobol</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Hydrological model performance metrics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hzambran/hydroGOF" class="external-link">hydroGOF</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-sensitivity-with-swatplusr">Using <code>sensitivity</code> with <code>SWATplusR</code><a class="anchor" aria-label="anchor" href="#using-sensitivity-with-swatplusr"></a>
</h3>
<p>The concept of <code>sensitivity</code> is to keep the model
parameters, the analyzed model, and the sensitivity analysis results
together in one object in <code>R</code>. When you define a sensitivity
analysis, you pass the model parameters and the model together in one
function call. This is however not an optimal way to use
<code>sensitivity</code> with <code>SWATplusR</code>. A more intuitive
workflow with <code>SWATplusR</code> is to define the model parameter
sets, perform the simulations (maybe with parallel processing), return
the model results, and analyze the simulations or calculated performance
metrics with any sensitivity analysis method.</p>
<p><code>sensitivity</code> offers a way to decouple the model
simulations and the sensitivity analysis with the function
<code><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell()</a></code>. You can first define a sensitivity analysis
experiment without passing model, run the simulations with the parameter
set that was defined in the experiment and calculate the sensitivity
indices afterwards with <code><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell()</a></code>. The simple example below,
that was taken from the <code><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell()</a></code> help page shows how the
decoupling works in a general way.</p>
<p>In this example a sensitivity analysis is designed using the eFAST
method. Three parameters (<code>factors</code>) and a sample size
<code>n = 1000</code> are defined. The important step here is that the
<code>model = NULL</code>, which means that no model was passed to the
sensitivity analysis setup initially.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/fast99.html" class="external-link">fast99</a></span><span class="op">(</span>model <span class="op">=</span> <span class="cn">NULL</span>, factors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'par1'</span>, <span class="st">'par2'</span>, <span class="st">'par3'</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            q <span class="op">=</span> <span class="st">"qunif"</span>, q.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="va">pi</span>, max <span class="op">=</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In a separate step the parameter set that was generated (stored in
<code>x$X</code>) is used to perform the model simulations. In the
simple example the <code><a href="https://rdrr.io/pkg/sensitivity/man/testmodels.html" class="external-link">ishigami.fun()</a></code> an example function from
the <code>sensitivity</code> package is used to run the simulations.
With a SWAT model, simulations using e.g. <code>run_swatplus</code>
would now be performed instead.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/testmodels.html" class="external-link">ishigami.fun</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell()</a></code> brings the designed sensitivity analysis
<code>x</code> together with the model simulations. The sensitivity
indices are calculated and also stored in the object <code>x</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>With <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> you can print the results of the
sensitivity analysis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fast99(model = NULL, factors = c("par1", "par2", "par3"), n = 1000,     q = "qunif", q.arg = list(min = -pi, max = pi))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model runs: 3000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimations of the indices:</span></span>
<span><span class="co">#&gt;       first order total order</span></span>
<span><span class="co">#&gt; par1 3.076874e-01   0.5506015</span></span>
<span><span class="co">#&gt; par2 4.419659e-01   0.4697538</span></span>
<span><span class="co">#&gt; par3 3.429110e-29   0.2391275</span></span></code></pre></div>
<p>And with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> you can visualize the results of the
sensitivity analysis.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="using-sensobol-with-swatplusr">Using <code>sensobol</code> with <code>SWATplusR</code><a class="anchor" aria-label="anchor" href="#using-sensobol-with-swatplusr"></a>
</h3>
<p><code>sensobol</code> uses a concept that better fits the workflow of
<code>SWATplusR</code>. Parameter sampling, running the simulations and
the sensitivity analysis are by default decoupled. The short example
below again shows an analysis of the Ishigami function this time using
the Sobol’ method from <code>sensobol</code>. You can see that sampling,
simulation and analysis are 3 separate function calls.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the parameter names</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"par"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># Create sample matrix to compute first and total-order indices</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/sobol_matrices.html" class="external-link">sobol_matrices</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">500</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span><span class="co"># Compute the model output (using the Ishigami test function)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/ishigami_Fun.html" class="external-link">ishigami_Fun</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></span>
<span><span class="co"># Compute and the Sobol' indices</span></span>
<span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, N <span class="op">=</span> <span class="fl">500</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>Again you can use <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> to print the analysis
results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ind</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First-order estimator: saltelli | Total-order estimator: jansen </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of model runs: 2500 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sum of first order indices: 0.4342083 </span></span>
<span><span class="co">#&gt;         original sensitivity parameters</span></span>
<span><span class="co">#&gt; 1:  0.4574752335          Si       par1</span></span>
<span><span class="co">#&gt; 2:  0.0013345109          Si       par2</span></span>
<span><span class="co">#&gt; 3: -0.0246014634          Si       par3</span></span>
<span><span class="co">#&gt; 4:  1.0218236406          Ti       par1</span></span>
<span><span class="co">#&gt; 5:  0.0009107365          Ti       par2</span></span>
<span><span class="co">#&gt; 6:  0.6165576890          Ti       par3</span></span></code></pre></div>
<p>And you can also use <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to plot the analysis
results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ind</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="parameter-screening-with-the-morris-method">Parameter screening with the Morris’ method<a class="anchor" aria-label="anchor" href="#parameter-screening-with-the-morris-method"></a>
</h2>
<p>The Morris’ method is useful for parameter screening to identify the
important parameters at a low cost (few number of simulations). The
Morris’ method does however only analyze the elementary effects of model
parameters (thus it is also called Morris’ elementary effects
screening). It uses a one-step-at-a-time method (OAT) sampling design
where only one parameter is changed in each step. The number of
simulations which are required for the elementary effects screening is
$r (p + 1) $, where <span class="math inline">\(p\)</span> is the number
of parameters and <span class="math inline">\(r\)</span> is the number
of repetitions of the OAT sampling.</p>
<p>In the example below we will perform a parameter screening for
simulated average annual sums of ET and average annual mean discharge.
The Morris’ method is implemented in <code>sensitivity</code>. For this
example and also the following examples we will use a small set of
parameter which are frequently used for model calibration.</p>
<div class="section level3">
<h3 id="used-model-parameters">Used Model parameters<a class="anchor" aria-label="anchor" href="#used-model-parameters"></a>
</h3>
<p>Below I defined a table with the 7 model parameters, the type of
change I want to apply to the initial parameter values, and the upper
and lower boundaries of the changes that we will apply to the parameter
values. The syntax in the definition of SWAT model parameters with
<code>SWATplusR</code> is important and is explained with great detail
in the <a href="https://chrisschuerz.github.io/SWATplusR/articles/SWATplusR.html#changing-parameter-values" class="external-link">Get
started</a> section. If you are not familiar with this concept, I
recommend you to go there first, before you continue with the
sensitivity analysis examples.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_bound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                    <span class="st">'epco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                    <span class="st">'cn2.hru | change = abschg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                    <span class="st">'cn3_swf.hru | change = abschg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                    <span class="st">'surlag.bsn | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                    <span class="st">'awc.sol | change = relchg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>                    <span class="st">'perco.hru | change = abschg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract parameter names from the names in par_bound</span></span>
<span><span class="va">par_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span>, <span class="st">'\\:\\:.*|\\..*'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-the-morris-screening-experiment">Defining the Morris’ screening experiment<a class="anchor" aria-label="anchor" href="#defining-the-morris-screening-experiment"></a>
</h3>
<p>As explained above we will define the Morris’ screening experiment
without passing a model (<code>model = NULL</code>) to the function
<code><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris()</a></code> and decouple the sensitivity analysis and the SWAT
simulations using the function <code><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell()</a></code> for the evaluation of
the simulation outputs. <code><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris()</a></code> provides different
sampling designs which are improvements over the experiment design that
was initially proposed by Morris (1991). Please see the <code>R</code>
package documentation if you want to implement one of those. For
demonstration we will use the default sampling design.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the Morris experiment design</span></span>
<span><span class="va">morris_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris</a></span><span class="op">(</span>model <span class="op">=</span> <span class="cn">NULL</span>, factors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span>, r <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                        design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'oat'</span>, levels <span class="op">=</span> <span class="fl">5</span>, grid.jump <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign the SWAT model parameter names to parameters in the experiment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">morris_sample</span><span class="op">$</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">par_names</span></span></code></pre></div>
<p>The experiment design results in a parameter set of 32 parameter
combinations. When printing the parameter set you can see a few things;
i) The model parameter range of each parameter is between 0 and 1, ii)
because we set <code>levels = 5</code> the interval steps in the
parameter space is 0.25 as the range 0 to 1 was split into 5 levels. You
can see a clear pattern of the parameter jumps of single parameters
while the others are kept constant. The parameter
<code>grid.jump = 3</code> defines that the sampling will jump 3 levels
when a parameter is changed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">morris_sample</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="co">#&gt;       esco epco  cn2 cn3_swf surlag  awc perco</span></span>
<span><span class="co">#&gt;  [1,] 0.00 0.75 0.00    0.00   1.00 0.25  0.25</span></span>
<span><span class="co">#&gt;  [2,] 0.00 0.75 0.00    0.00   1.00 1.00  0.25</span></span>
<span><span class="co">#&gt;  [3,] 0.00 0.00 0.00    0.00   1.00 1.00  0.25</span></span>
<span><span class="co">#&gt;  [4,] 0.00 0.00 0.00    0.00   0.25 1.00  0.25</span></span>
<span><span class="co">#&gt;  [5,] 0.00 0.00 0.75    0.00   0.25 1.00  0.25</span></span>
<span><span class="co">#&gt;  [6,] 0.00 0.00 0.75    0.75   0.25 1.00  0.25</span></span>
<span><span class="co">#&gt;  [7,] 0.00 0.00 0.75    0.75   0.25 1.00  1.00</span></span>
<span><span class="co">#&gt;  [8,] 0.75 0.00 0.75    0.75   0.25 1.00  1.00</span></span>
<span><span class="co">#&gt;  [9,] 0.75 1.00 0.75    1.00   0.25 0.00  0.75</span></span>
<span><span class="co">#&gt; [10,] 0.00 1.00 0.75    1.00   0.25 0.00  0.75</span></span>
<span><span class="co">#&gt; [11,] 0.00 1.00 0.75    1.00   0.25 0.00  0.00</span></span>
<span><span class="co">#&gt; [12,] 0.00 1.00 0.75    1.00   0.25 0.75  0.00</span></span>
<span><span class="co">#&gt; [13,] 0.00 1.00 0.75    0.25   0.25 0.75  0.00</span></span>
<span><span class="co">#&gt; [14,] 0.00 1.00 0.75    0.25   1.00 0.75  0.00</span></span>
<span><span class="co">#&gt; [15,] 0.00 0.25 0.75    0.25   1.00 0.75  0.00</span></span>
<span><span class="co">#&gt; [16,] 0.00 0.25 0.00    0.25   1.00 0.75  0.00</span></span>
<span><span class="co">#&gt; [17,] 1.00 1.00 0.75    1.00   0.25 0.75  0.00</span></span>
<span><span class="co">#&gt; [18,] 1.00 1.00 0.75    1.00   0.25 0.75  0.75</span></span>
<span><span class="co">#&gt; [19,] 1.00 1.00 0.75    0.25   0.25 0.75  0.75</span></span>
<span><span class="co">#&gt; [20,] 1.00 1.00 0.75    0.25   0.25 0.00  0.75</span></span>
<span><span class="co">#&gt; [21,] 1.00 1.00 0.00    0.25   0.25 0.00  0.75</span></span>
<span><span class="co">#&gt; [22,] 1.00 0.25 0.00    0.25   0.25 0.00  0.75</span></span>
<span><span class="co">#&gt; [23,] 1.00 0.25 0.00    0.25   1.00 0.00  0.75</span></span>
<span><span class="co">#&gt; [24,] 0.25 0.25 0.00    0.25   1.00 0.00  0.75</span></span>
<span><span class="co">#&gt; [25,] 1.00 1.00 0.00    0.00   0.25 0.25  1.00</span></span>
<span><span class="co">#&gt; [26,] 1.00 1.00 0.00    0.00   1.00 0.25  1.00</span></span>
<span><span class="co">#&gt; [27,] 1.00 1.00 0.00    0.00   1.00 1.00  1.00</span></span>
<span><span class="co">#&gt; [28,] 1.00 1.00 0.00    0.75   1.00 1.00  1.00</span></span>
<span><span class="co">#&gt; [29,] 1.00 0.25 0.00    0.75   1.00 1.00  1.00</span></span>
<span><span class="co">#&gt; [30,] 0.25 0.25 0.00    0.75   1.00 1.00  1.00</span></span>
<span><span class="co">#&gt; [31,] 0.25 0.25 0.00    0.75   1.00 1.00  0.25</span></span>
<span><span class="co">#&gt; [32,] 0.25 0.25 0.75    0.75   1.00 1.00  0.25</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="swat-model-simulations">SWAT model simulations<a class="anchor" aria-label="anchor" href="#swat-model-simulations"></a>
</h3>
<p>As the sampled parameter values vary between 0 to 1 we have to
transform them to the parameter boundaries that we defined for the SWAT
model parameter. You can use the recipe below to transform parameter
ranges from 0 to 1 to the actual parameter ranges. These lines of code
you will find in many examples as the task of transforming parameter
values from 0 to 1 to the actual SWAT parameter values will be often
necessary.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_morris</span> <span class="op">&lt;-</span> <span class="va">morris_sample</span><span class="op">$</span><span class="va">X</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span>, .name_repair <span class="op">=</span> <span class="st">'minimal'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Convert to a tibble</span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assign the parameter names with purrr</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map2_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">par_bound</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="op">(</span><span class="va">.y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We will again use the SWAT+ demo project to perform the model
simulations. You can load the demo path again by running
<code><a href="../reference/load_demo.html">load_demo()</a></code>, or use the demo path from previous examples,
if you do have the demo project already on your hard drive. Loading the
existing demoe with <code><a href="../reference/load_demo.html">load_demo()</a></code> in the same path will not
overwrite the existing demo, but will return the path to the demo
project that you can further use.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The path where the SWAT demo project will be written</span></span>
<span><span class="va">demo_path</span> <span class="op">&lt;-</span> <span class="st">'Define:/your/path'</span></span>
<span></span>
<span><span class="co"># Loading a SWAT+ demo project</span></span>
<span><span class="va">path_plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'project'</span>,</span>
<span>                       path <span class="op">=</span> <span class="va">demo_path</span>,</span>
<span>                       version <span class="op">=</span> <span class="st">'plus'</span><span class="op">)</span></span></code></pre></div>
<p>We perform daily simulations for the basin average evapotranspiration
(<code>et</code>) and the discharge (<code>q</code>) in the channel of
the model setup.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_morris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,</span>
<span>                           output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>et <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb'</span>,</span>
<span>                                                            variable <span class="op">=</span> <span class="st">'et'</span>,</span>
<span>                                                            unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                         q  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'channel_sd'</span>,</span>
<span>                                                            variable <span class="op">=</span> <span class="st">'flo_out'</span>,</span>
<span>                                                            unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           parameter <span class="op">=</span> <span class="va">par_morris</span>,</span>
<span>                           start_date <span class="op">=</span> <span class="fl">20030101</span>,</span>
<span>                           end_date <span class="op">=</span> <span class="fl">20121231</span>,</span>
<span>                           start_date_print <span class="op">=</span> <span class="fl">20060101</span>,</span>
<span>                           n_thread <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; Building 4 threads in 'Define:/your/path/swatplus_rev60_demo/.model_run': </span></span>
<span><span class="co">#&gt;  Completed 4 threads in 0S                                                  </span></span>
<span><span class="co">#&gt; Performing 32 simulations on 4 cores: </span></span>
<span><span class="co">#&gt;  Completed 32 simulations in 1M 14S   </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="output-aggregation-and-sensitivity-analysis">Output aggregation and sensitivity analysis<a class="anchor" aria-label="anchor" href="#output-aggregation-and-sensitivity-analysis"></a>
</h3>
<p>We will perform the sensitivity analysis with the Morris’ method for
average annual values of ET and discharge. We could have also returned
average annual values already in the model execution. I do prefer
however to write daily values and perform any aggregation later on, as
it gives me full control over the aggregation step. For the temporal
aggregation we can again use the functions that we know from previous
examples.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggregate_annual</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">fun</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, <span class="op">~</span> <span class="fu">fun</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To calculate average annual ET we first calculate annual sums and
then calculate the average of the annual sums.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">et_annual</span> <span class="op">&lt;-</span> <span class="va">sim_morris</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">et</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">aggregate_annual</span><span class="op">(</span><span class="va">.</span>, <span class="va">sum</span><span class="op">)</span></span>
<span></span>
<span><span class="va">et_avann</span> <span class="op">&lt;-</span> <span class="va">et_annual</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>As explained in the introduction of <code>sensitivity</code> above we
now have to “tell” our Morris’ sampling design the model output. This is
done with the function <code><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">morris_et</span> <span class="op">&lt;-</span> <span class="va">morris_sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell</a></span><span class="op">(</span><span class="va">morris_et</span>, <span class="va">et_avann</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> returns the results of the sensitivity analysis
in tabular form.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">morris_et</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; morris(model = NULL, factors = ncol(par_bound), r = 4, design = list(type = "oat",     levels = 5, grid.jump = 3))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model runs: 32 </span></span>
<span><span class="co">#&gt;                mu  mu.star    sigma</span></span>
<span><span class="co">#&gt; esco     77.36638 77.36638 63.31053</span></span>
<span><span class="co">#&gt; epco     73.40938 73.40938 74.54560</span></span>
<span><span class="co">#&gt; cn2     -30.79586 30.79586 23.24428</span></span>
<span><span class="co">#&gt; cn3_swf  35.43714 35.43714 52.23233</span></span>
<span><span class="co">#&gt; surlag    0.00000  0.00000  0.00000</span></span>
<span><span class="co">#&gt; awc      43.16029 43.16029 14.98067</span></span>
<span><span class="co">#&gt; perco   -86.30019 86.30019 38.16950</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> plots the resulting sensitivity of average annual
ET for the analyzed model parameters. Plotting sensitivity analyses
performed with <code>sensitivity</code> results in different plot types
depending on the used method. For Morris’ method the statistics <span class="math inline">\(\mu^{*}\)</span> and <span class="math inline">\(\sigma\)</span> are plotted, where <span class="math inline">\(\mu^{*}\)</span> is the mean sensitivity value and
<span class="math inline">\(\sigma\)</span> is its standard deviation.
<span class="math inline">\(\mu^{*}\)</span> can be interpreted as the
direct effect of a parameter, while <span class="math inline">\(\sigma\)</span> describes interaction effects of a
parameter.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">morris_et</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>In our example we can see that <em>surlag</em> does not have any
effect on ET, while for example <em>perco</em> has a strong direct
linear effect but a low interaction with other parameters. <em>esco</em>
and <em>epco</em>, two other highly relevant parameters, show both large
<span class="math inline">\(\mu^{*}\)</span> and large <span class="math inline">\(\sigma\)</span> values.</p>
<p>As we also simulated the discharge we can perform the same analysis
with the average annual discharge. In this case we will simply calculate
the mean discharge in <span class="math inline">\(m^3
s^{-1}\)</span>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_avann</span> <span class="op">&lt;-</span> <span class="va">sim_morris</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>Again we “tell” our sampling design the simulated average annual
values and plot the results of the sensitivity analysis. For the
simulation of mean average annual discharge <em>perco</em> is again by
far the most relevant parameter. This makes sense, as when larger
amounts of water infiltrate the lower the average discharge will be.
<em>cn3_swf</em> a parameter that is less important for ET is now more
relevant. <em>cn3_swf</em> is a parameter that controls the calculation
of the daily curve number values and thus affects the runoff. In
contrast to <em>perco</em>, <em>cn3_swf</em> shows a large interaction
component <span class="math inline">\(\sigma\)</span>. Again,
<em>surlag</em> shows no relevance for discharge, although this
parameter controls properties of the surface runoff. But we analyzed
long term mean discharges here. That <em>surlag</em> does not have any
impact on long term average values seems plausible to me.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">morris_q</span> <span class="op">&lt;-</span> <span class="va">morris_sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell</a></span><span class="op">(</span><span class="va">morris_q</span>, <span class="va">q_avann</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">morris_q</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.11</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.07</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis-with-vars">Sensitivity analysis with VARS<a class="anchor" aria-label="anchor" href="#sensitivity-analysis-with-vars"></a>
</h2>
<p>VARS is a state-of-the-art method for global sensitivity analysis
(GSA) that implements variograms of the parameter response surface to
estimate parameter sensitivities. The calculation of total order VARS
sensitivity indices is implemented in the <code>sensobol</code> package.
Below I show two small example that implement the VARS method with
average annual SWAT+ simulation outputs but also when we use scalar
performance metrics.</p>
<div class="section level3">
<h3 id="star-sampling">STAR sampling<a class="anchor" aria-label="anchor" href="#star-sampling"></a>
</h3>
<p>VARS uses a specific sampling design for which ‘center points’ in the
parameter space are defined. From these center points transects with a
defined step width <code>h</code> are sampled along each parameter
dimension. For our small VARS experiment we define the following STAR
sample.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of STAR sample centers</span></span>
<span><span class="va">star_centers</span> <span class="op">&lt;-</span> <span class="fl">10</span> </span>
<span><span class="co"># Normalized step width of the transects </span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># Create STAR sample</span></span>
<span><span class="va">star_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/vars_matrices.html" class="external-link">vars_matrices</a></span><span class="op">(</span>star.centers <span class="op">=</span> <span class="va">star_centers</span>, params <span class="op">=</span> <span class="va">par_names</span>, h <span class="op">=</span> <span class="va">h</span><span class="op">)</span></span></code></pre></div>
<p>The number of star centers was set to
<code>star_centers &lt;- 10</code> in our example. For a practical
application this number should be larger and I would recommend to
increase the number to e.g. <code>star_centers &lt;- 50</code>. In this
example I simply wanted to keep the computation time at acceptable
levels. 10 center points, 7 parameters and a step width of
<code>h &lt;- 0.1</code> resulted in 640 parameter combinations which we
use in our SWAT simulations. For the implementation in
<code><a href="../reference/run_swatplus.html">run_swatplus()</a></code> we have to transform the matrix
<code>star_sample</code> into a <code>tibble</code> with the proper
parameter names parameter value ranges which are defined in
<code>par_bound</code>. The procedure is the same as in the previous
example.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_star</span> <span class="op">&lt;-</span> <span class="va">star_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span>, .name_repair <span class="op">=</span> <span class="st">'minimal'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Convert to a tibble</span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assign the parameter names with purrr</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map2_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">par_bound</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="op">(</span><span class="va">.y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="swat-simulations">SWAT simulations<a class="anchor" aria-label="anchor" href="#swat-simulations"></a>
</h3>
<p>We will again simulate ET and discharge which we already analyzed in
the Morris’ example. We keep the same time periods and the same start
date to print simulation outputs. Hence the only input argument that we
have to change in the simulation run is the parameter set that we want
to use. We define <code>parameter = par_star</code> to implement the
parameter set that we sampled with the STAR sampling design.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,</span>
<span>                         output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>et <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb'</span>,</span>
<span>                                                          variable <span class="op">=</span> <span class="st">'et'</span>,</span>
<span>                                                          unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                       q  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'channel_sd'</span>,</span>
<span>                                                          variable <span class="op">=</span> <span class="st">'flo_out'</span>,</span>
<span>                                                          unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         parameter <span class="op">=</span> <span class="va">par_star</span>,</span>
<span>                         start_date <span class="op">=</span> <span class="fl">20030101</span>,</span>
<span>                         end_date <span class="op">=</span> <span class="fl">20121231</span>,</span>
<span>                         start_date_print <span class="op">=</span> <span class="fl">20060101</span>,</span>
<span>                         n_thread <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; Building 4 threads in 'Define:/your/path/swatplus_rev60_demo/.model_run': </span></span>
<span><span class="co">#&gt;  Completed 4 threads in 0S                                                  </span></span>
<span><span class="co">#&gt; Performing 640 simulations on 4 cores: </span></span>
<span><span class="co">#&gt;  Completed 640 simulations in 27M 45S</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculation-of-vars-sensitivity">Calculation of VARS sensitivity<a class="anchor" aria-label="anchor" href="#calculation-of-vars-sensitivity"></a>
</h3>
<p>The calculation of the total order sensitivity indices is done with
the function <code><a href="https://rdrr.io/pkg/sensobol/man/vars_to.html" class="external-link">vars_to()</a></code>. You have to provide scalar model
outputs (single value per parameter combination) and the STAR sample
including its sampling design. For ET we again use the average annual ET
sums. So we aggregate the daily simulations and use them to calculate
the parameter sensitivities.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">et_avann</span> <span class="op">&lt;-</span> <span class="va">sim_vars</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">et</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">aggregate_annual</span><span class="op">(</span><span class="va">.</span>, <span class="va">sum</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vars_et</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/vars_to.html" class="external-link">vars_to</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">et_avann</span>, star.centers <span class="op">=</span> <span class="va">star_centers</span>, </span>
<span>                   params <span class="op">=</span> <span class="va">par_names</span>, h <span class="op">=</span> <span class="va">h</span><span class="op">)</span></span></code></pre></div>
<p>Printing the sensitivity analysis results with VARS gives you a table
with the total order sensitivity values for the analyzed parameters. The
<span class="math inline">\(Ti\)</span> values can vary in a range
between 0 and 1, where 0 indicates that a parameter has no relevance and
values closer to 1 mean large sensitivities. As with the Morris’ method
<em>surlag</em> has no influence. <em>epco</em> results to be the most
relevant parameter, followed by perco.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars_et</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of star centers: 10 | h: 0.1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of model runs: 640 </span></span>
<span><span class="co">#&gt;            Ti parameters</span></span>
<span><span class="co">#&gt; 1: 0.23730114       esco</span></span>
<span><span class="co">#&gt; 2: 0.66438595       epco</span></span>
<span><span class="co">#&gt; 3: 0.06175698        cn2</span></span>
<span><span class="co">#&gt; 4: 0.01860577    cn3_swf</span></span>
<span><span class="co">#&gt; 5: 0.00000000     surlag</span></span>
<span><span class="co">#&gt; 6: 0.16586504        awc</span></span>
<span><span class="co">#&gt; 7: 0.39084430      perco</span></span></code></pre></div>
<p><code>sensobol</code> does not provide a function to plot the results
of a VARS analysis. But using the table <code>vars_et$results</code>
with <code>ggplot</code> you can quickly generate your own plot, like in
the short example below.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vars_et</span><span class="op">$</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">parameters</span>, y <span class="op">=</span> <span class="va">Ti</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p><code>SWATdata</code> provides observation data for the discharge at
the demo catchment outlet. For the simulated discharge we will now use
calculate <code>NSE</code> values from the daily simulated and the
observed discharge and use those scalar performance metrics in the
sensitivity analysis.</p>
<p>We first have to load the observation data with
<code><a href="../reference/load_demo.html">load_demo()</a></code> and trim it to the same time period as we
performed our simulations for.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'obs'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sim_vars</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></code></pre></div>
<p>Below we use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl()</a></code> to apply the function
<code><a href="https://rdrr.io/pkg/hydroGOF/man/NSE.html" class="external-link">NSE()</a></code> to all simulated time series of the discharge to
calculate the <code>NSE</code> values for all parameter combinations of
our STAR parameter set.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nse_q</span> <span class="op">&lt;-</span> <span class="va">sim_vars</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/hydroGOF/man/NSE.html" class="external-link">NSE</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">obs</span><span class="op">$</span><span class="va">discharge</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With <code><a href="https://rdrr.io/pkg/sensobol/man/vars_to.html" class="external-link">vars_to()</a></code> we again calculate the total order
sensitivity values.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars_nse_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/vars_to.html" class="external-link">vars_to</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">nse_q</span>, star.centers <span class="op">=</span> <span class="va">star_centers</span>, </span>
<span>                      params <span class="op">=</span> <span class="va">par_names</span>, h <span class="op">=</span> <span class="va">h</span><span class="op">)</span></span></code></pre></div>
<p>The parameter <em>perco</em> has the strongest impact on the daily
discharge simulations when they are evaluated with the <code>NSE</code>.
The parameters <em>cn2</em> and <em>cn3_swf</em> are as well relevant
for the simulation of discharge. Although the impact of <em>surlag</em>
is not 0 it is rather low (same applies to <em>awc</em>).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vars_nse_q</span><span class="op">$</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">parameters</span>, y <span class="op">=</span> <span class="va">Ti</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis-with-the-sobol-method">Sensitivity analysis with the Sobol’ method<a class="anchor" aria-label="anchor" href="#sensitivity-analysis-with-the-sobol-method"></a>
</h2>
<p>The Sobol’ method is a well established method to perform global
sensitivity analysis and is often considered as a benchmark method to
e.g. compare new methods to. Both of the presented <code>R</code>
packages <code>sensitivity</code> and <code>sensobol</code> offer a
large number of implementations of the Sobol’ method with adjustments
such as different sampling schemes and adapted estimators for the first
and total order sensitivity indices. In the example below we use the
implementation of the Sobol’ method from the <code>sensobol</code>
package. Without executing the code I added the setup of the Sobol’
sensitivity analysis with the <code>sensitivity</code> package below.
The function calls differ a bit. But eventually the same analysis would
be performed.</p>
<div class="section level3">
<h3 id="parameter-sampling">Parameter sampling<a class="anchor" aria-label="anchor" href="#parameter-sampling"></a>
</h3>
<p>With <code><a href="https://rdrr.io/pkg/sensobol/man/sobol_matrices.html" class="external-link">sobol_matrices()</a></code> you sample the parameter matrices
which are needed to compute Sobol’ indices. The function requires a base
sample size that we defined with <code>n &lt;- 100</code> here. We will
see below in the results that the confidence intervals of the calculated
sensitivity indices will be wide. Thus, in an actual application of the
Sobol’ method I would recommend to use base sample sizes larger that 500
to 1000. Such large samples would however be computationally expensive
and we therefore use the lower sample size. With
<code>order = 'first'</code> we define that we want to calculate only
first and total order sensitivities. In this case the function would
create a matrix with <span class="math inline">\(n \cdot (p +
2)\)</span> parameter combinations, where n is the base sample size and
p is the number of parameters. In our case we have to perform the
simulations for 900 parameter combinations.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">sobol_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/sobol_matrices.html" class="external-link">sobol_matrices</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span>, order <span class="op">=</span> <span class="st">'first'</span><span class="op">)</span></span></code></pre></div>
<p>Again we have to transform the parameter values to the ranges of the
actual SWAT model parameters that we will use in the model
simulations.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_sobol</span> <span class="op">&lt;-</span> <span class="va">sobol_mat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Convert to a tibble</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map2_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">par_bound</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="op">(</span><span class="va">.y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="swat-model-simulations-1">SWAT model simulations<a class="anchor" aria-label="anchor" href="#swat-model-simulations-1"></a>
</h3>
<p>As in the previous examples we will simulate ET and the discharge.
Because the number of required simulations is large than in the previous
examples we will use a shorter simulation period between
<code>start_date = 20050101</code> and <code>end_date = 20101231</code>
where we print the years starting from
<code>start_date_print = 20080101</code>. We will also use the new
parameter set <code>parameter = par_sobol</code> now for the
simulations.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_sobol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,</span>
<span>                          output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>et <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb'</span>,</span>
<span>                                                           variable <span class="op">=</span> <span class="st">'et'</span>,</span>
<span>                                                           unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                        q  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'channel_sd'</span>,</span>
<span>                                                           variable <span class="op">=</span> <span class="st">'flo_out'</span>,</span>
<span>                                                           unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          parameter <span class="op">=</span> <span class="va">par_sobol</span>,</span>
<span>                          start_date <span class="op">=</span> <span class="fl">20050101</span>,</span>
<span>                          end_date <span class="op">=</span> <span class="fl">20101231</span>,</span>
<span>                          start_date_print <span class="op">=</span> <span class="fl">20080101</span>,</span>
<span>                          n_thread <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; Building 4 threads in 'Define:/your/path/swatplus_rev60_demo/.model_run': </span></span>
<span><span class="co">#&gt;  Completed 4 threads in 0S                                                  </span></span>
<span><span class="co">#&gt; Performing 900 simulations on 4 cores: </span></span>
<span><span class="co">#&gt;  Completed 900 simulations in 21M 6S </span></span>
<span><span class="co">#&gt; Performing 450 simulations on 4 cores: </span></span>
<span><span class="co">#&gt; Completed 450 simulations in 12M 51S </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sobol-analysis-for-average-annual-et">Sobol analysis for average annual ET<a class="anchor" aria-label="anchor" href="#sobol-analysis-for-average-annual-et"></a>
</h3>
<p>For the analysis of ET we will again use average annual values that
we calculate with code from the previous examples. The Sobol’
sensitivity indices are calculated with the function
<code><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices()</a></code>. In this function you have different
options to calculate <code>first</code> and <code>total</code> order
sensitivities. I selected the method of Jansen <span class="citation">(<a href="#ref-Jansen1999">1999</a>)</span> here. You
could select any of the available methods. The simple reason why I
selected this method over others here is because it results in smaller
confidence intervals with the small selected base sample. So this is
just for demonstration reasons. To get conficence intervals you have to
set <code>boot = TRUE</code> and provide a value for the bootstrap
replicas <code>R</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">et_avann</span> <span class="op">&lt;-</span> <span class="va">sim_sobol</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">et</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">aggregate_annual</span><span class="op">(</span><span class="va">.</span>, <span class="va">sum</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sobol_et</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">et_avann</span>, N <span class="op">=</span> <span class="va">n</span>, params <span class="op">=</span> <span class="va">par_names</span>, </span>
<span>                          first <span class="op">=</span> <span class="st">"jansen"</span>, total <span class="op">=</span> <span class="st">'jansen'</span>,</span>
<span>                          boot <span class="op">=</span> <span class="cn">TRUE</span>, R <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>With bootstrapping the results table is now more comprehensive as it
also provides e.g. a standard error and the lower and upper confidence
intervals for the estimates of the sensitivity indices. The results show
the first order and total order sensitivities together in one table.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sobol_et</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First-order estimator: jansen | Total-order estimator: jansen </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of model runs: 900 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sum of first order indices: 0.7842864 </span></span>
<span><span class="co">#&gt;         original          bias   std.error       low.ci    high.ci sensitivity</span></span>
<span><span class="co">#&gt;  1:  0.072933021 -0.0110289078 0.084874880 -0.082389778 0.25031364          Si</span></span>
<span><span class="co">#&gt;  2:  0.483465576 -0.0021534952 0.065960955  0.356337975 0.61490017          Si</span></span>
<span><span class="co">#&gt;  3:  0.021484098 -0.0031559127 0.084708895 -0.141386373 0.19066639          Si</span></span>
<span><span class="co">#&gt;  4: -0.008710804  0.0006357511 0.081270816 -0.168634427 0.14994132          Si</span></span>
<span><span class="co">#&gt;  5: -0.035221870 -0.0017282910 0.084528029 -0.199165472 0.13217831          Si</span></span>
<span><span class="co">#&gt;  6:  0.065330458  0.0031669326 0.089934866 -0.114105572 0.23843262          Si</span></span>
<span><span class="co">#&gt;  7:  0.185005918 -0.0141125583 0.097839941  0.007355715 0.39088124          Si</span></span>
<span><span class="co">#&gt;  8:  0.140854763  0.0045212605 0.032219436  0.073184569 0.19948244          Ti</span></span>
<span><span class="co">#&gt;  9:  0.475671672  0.0170372765 0.061370180  0.338351054 0.57891774          Ti</span></span>
<span><span class="co">#&gt; 10:  0.030857046 -0.0002044961 0.005935057  0.019429043 0.04269404          Ti</span></span>
<span><span class="co">#&gt; 11:  0.016990857  0.0001053053 0.005182207  0.006728613 0.02704249          Ti</span></span>
<span><span class="co">#&gt; 12:  0.000000000  0.0000000000 0.000000000  0.000000000 0.00000000          Ti</span></span>
<span><span class="co">#&gt; 13:  0.077937102  0.0018423710 0.012304079  0.051979178 0.10021028          Ti</span></span>
<span><span class="co">#&gt; 14:  0.276161819  0.0024053693 0.038292068  0.198705377 0.34880752          Ti</span></span>
<span><span class="co">#&gt;     parameters</span></span>
<span><span class="co">#&gt;  1:       esco</span></span>
<span><span class="co">#&gt;  2:       epco</span></span>
<span><span class="co">#&gt;  3:        cn2</span></span>
<span><span class="co">#&gt;  4:    cn3_swf</span></span>
<span><span class="co">#&gt;  5:     surlag</span></span>
<span><span class="co">#&gt;  6:        awc</span></span>
<span><span class="co">#&gt;  7:      perco</span></span>
<span><span class="co">#&gt;  8:       esco</span></span>
<span><span class="co">#&gt;  9:       epco</span></span>
<span><span class="co">#&gt; 10:        cn2</span></span>
<span><span class="co">#&gt; 11:    cn3_swf</span></span>
<span><span class="co">#&gt; 12:     surlag</span></span>
<span><span class="co">#&gt; 13:        awc</span></span>
<span><span class="co">#&gt; 14:      perco</span></span></code></pre></div>
<p>For the Sobol’ method <code>sensobol</code> provides a
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> option. <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> returns a
<code>ggplot</code> for both, the first and the total order sensitivity
values for the analyzed parameters. The whiskers show the confidence
intervals of the sensitivity estimates. The results are comparable to
the previous sensitivity experiments with the largest sensitivity values
for <em>epco</em> and <em>perco</em>. We used the bootstrapping option
for the Sobol’ indices which give us an idea about the uncertainties of
the estimates. Due to the used small base sample size the confidence
intervals are large. You can try other methods for the calculation of
the first and total order sensitivities and you will see that the
confidence intervals computation can then lead to even more excessive
values.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sobol_et</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="using-sensitivity-for-the-sobol-analysis">Using <code>sensitivity</code> for the Sobol’ analysis<a class="anchor" aria-label="anchor" href="#using-sensitivity-for-the-sobol-analysis"></a>
</h3>
<p>The code below performs the Sobol’ analysis using the
<code>sensitivity</code> package instead of <code>sensobol</code>. The
implementation of methods in <code>sensitivity</code> is even more
comprehensive compared to <code>sensobol</code>. Eventually the use of
both methods should lead to comparable results as both use variants of
the Sobol’ method. The code below is no complete workflow but should
show you the differences in the application of the Sobol’ method.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ns</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">par_names</span><span class="op">)</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">np</span> <span class="op">*</span> <span class="va">ns</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">ns</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="va">par_names</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">np</span> <span class="op">*</span> <span class="va">ns</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">ns</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="va">par_names</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sobol_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/sobolSalt.html" class="external-link">sobolSalt</a></span><span class="op">(</span>model <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">X1</span>, <span class="va">X2</span>, scheme<span class="op">=</span><span class="st">"A"</span>, nboot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">par_sobol</span> <span class="op">&lt;-</span> <span class="va">sobol_sample</span><span class="op">$</span><span class="va">X</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span>, .name_repair <span class="op">=</span> <span class="st">'minimal'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Convert to a tibble</span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assign the parameter names with purrr</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map2_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">par_bound</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="op">(</span><span class="va">.y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here you would simulate ET and aggregate to average annual values.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/decoupling.html" class="external-link">tell</a></span><span class="op">(</span><span class="va">sobol_sample</span>, <span class="va">et_avann</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">sobol_sample</span><span class="op">$</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">par_names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">sobol_sample</span><span class="op">$</span><span class="cn">T</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">par_names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sobol_sample</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sobol_sample</span>, choice<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sobol-analysis-for-nse-values-of-discharge">Sobol analysis for NSE values of discharge<a class="anchor" aria-label="anchor" href="#sobol-analysis-for-nse-values-of-discharge"></a>
</h3>
<p>In contrast to the example of average annual ET values we will
implement <em>NSE</em> values as scalar output variables in the
sensitivity analysis. The <em>NSE</em> expresses the goodness-of-fit of
the simulated discharge compared to the observed discharge in a scalar
value between <span class="math inline">\(-\inf\)</span> and 1.</p>
<p>For the evaluation of the simulated discharge time series with
observed data we will load the the observation data for the demo model
setup using <code><a href="../reference/load_demo.html">load_demo()</a></code>. We trim the observed data to the
same time period as the simulations with <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'obs'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sim_sobol</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></code></pre></div>
<p>To get a vector of <em>NSE</em> values for all simulated discharge
time series we <code><a href="https://rdrr.io/pkg/hydroGOF/man/NSE.html" class="external-link">NSE()</a></code> from the <code>hydroGOF</code> package
and <code>map</code> over all simulated time series.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nse_q</span> <span class="op">&lt;-</span> <span class="va">sim_sobol</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/hydroGOF/man/NSE.html" class="external-link">NSE</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">obs</span><span class="op">$</span><span class="va">discharge</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We again use <code><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices()</a></code> to estimate the Sobol’
indices for the parameters and the calculated <em>NSE</em> values. We
will leave the settings from the ET example unchanged.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sobol_nse_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">nse_q</span>, N <span class="op">=</span> <span class="va">n</span>, params <span class="op">=</span> <span class="va">par_names</span>, </span>
<span>                             first <span class="op">=</span> <span class="st">"jansen"</span>, total <span class="op">=</span> <span class="st">'jansen'</span>,</span>
<span>                             boot <span class="op">=</span> <span class="cn">TRUE</span>, R <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Below we again use <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to do a ggplot of the Sobol’
analysis. The results are comparable to the ones of the VARS analysis,
where the largest sensitivity inidices were found for <em>perco</em>,
<em>cn2</em>, and <em>cn3_swf</em>. Also in this example the confidence
intervals are wide and in a practical applicaction we might use a larger
base sample size.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sobol_nse_q</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="temporal-sensitivity-analysis">Temporal sensitivity analysis<a class="anchor" aria-label="anchor" href="#temporal-sensitivity-analysis"></a>
</h3>
<p>With a few steps we can transform the sensitivity analysis into a
temporal analysis, where we can use the daily simulations for the
sampled Sobol’ parameter set. This example gives another good argument
why I prefer to do all simulations with daily time steps and perform any
data aggregation after the simulations. It is always better to keep all
information and reduce it when we have to.</p>
<p>The small difference between the previous sensitivity analyses and a
temporal one is simply that before we aggregated the simulated time
series to scalar values, while now we just do the analysis for the
simulated values of each time step which are already scalar values.
There is really not more to that!</p>
<p>To achieve this calculation in practice we will loop over all the
time steps of the simulations and perform a sensitivity analysis in each
time step. For a later analysis we will then put the results of all
individual analyses together into one table. The looping will be done in
a <code>for</code> loop (At this point I have to assume that you are
familiar with basic elements of programming such as <code>for</code>
loops). Before we iterate over all dates we generate an empty list
<code>s</code> where we will store the analysis results for each time
step as an individual element in this list. To make the analysis a bit
simpler and shorter we will do the analysis only for the days of the
year 2009. Thus we extract the simulated discharges of the year 2009
from our simulations and assign them to the variale <code>q_2009</code>.
In the loop we again use the function <code><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices()</a></code> for
the calculation of the Sobol’ indices. By taking only the <span class="math inline">\(i^{th}\)</span> line of the discharge data and the
columns starting from 2 (<code>q_2009[i, 2:ncol(q_2009)</code>) we
perform the analysis for all discharges on the day <span class="math inline">\(i\)</span>. The <code><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist()</a></code> is necessary
here to convert the values from the table to a vector. All other input
arguments in <code><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices()</a></code> we know already from the
previous examples. After the loop we bind all results together into one
table using <code><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows()</a></code>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">q_2009</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sim_sobol</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2009</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">q_2009</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensobol/man/sobol_indices.html" class="external-link">sobol_indices</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">q_2009</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">q_2009</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                          N <span class="op">=</span> <span class="va">n</span>, params <span class="op">=</span> <span class="va">par_names</span>, </span>
<span>                          first <span class="op">=</span> <span class="st">"jansen"</span>, total <span class="op">=</span> <span class="st">'jansen'</span>,</span>
<span>                          boot <span class="op">=</span> <span class="cn">TRUE</span>, R <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="va">.</span><span class="op">$</span><span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.</span>, date <span class="op">=</span> <span class="va">q_2009</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p>We want to show the temporal sensitivity analysis in a rather
comprehensive plot, where we want to show the simulated upper and lower
bounds of discharge together with the first and total order Sobol’
estimates for the parameters including the calculated confidence
intervals.</p>
<p>In a first step we prepare the discharge data of the year 2009
(<code>q_2009</code>) for the plot of the simulated ranges. Below we
select all columns except the <code>.$date</code> column and calculate
the minimum and maximum values for each line (time step) using the
<code><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl()</a></code> function and passing it the functions
<code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min()</a></code> and <code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max()</a></code>. In general this is a very
efficient way to calculate rowwise values. There are other ways (you can
e.g. look for <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise()</a></code> and the <code>across*()</code>
functionality of <code>dplyr</code>. The <code>base R</code> way would
be to e.g. use <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code>) but some of those approaches are
sometimes a bit slow. Finally, we only select the computed min and max
values <code>qmin</code> and <code>qmax</code> and add again the
date.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_bound</span> <span class="op">&lt;-</span> <span class="va">q_2009</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>qmax <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">max</span><span class="op">)</span>,</span>
<span>         qmin <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">min</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">qmin</span>, <span class="va">qmax</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">q_2009</span><span class="op">$</span><span class="va">date</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>For the discharge we prepare a <code>ggplot</code> where we will show
the simulated ranges as grey areas (<code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code>). The
boundaries of the area we border with lines (<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code>).
We give our plot the final touch by adding a better y-axis title and use
the black and white theme (<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw()</a></code> which I prefer a bit
over the standard theme). We will also remove all the text on the x-axis
with <code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme()</a></code> settings, as we will put the discharge and the
sensitivity plot together in the final step below.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">q_bound</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">qmin</span>, ymax <span class="op">=</span> <span class="va">qmax</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">'grey30'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">qmin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'grey30'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">qmax</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'grey30'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span> <span class="op">(</span><span class="va">Discharge</span><span class="op">~</span><span class="op">(</span><span class="va">m</span><span class="op">^</span><span class="fl">3</span><span class="op">~</span><span class="va">s</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The sensitivity plot should have a similar structure as the discharge
plot. Again we plot the calculated confidence intervals with areas
(<code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code>) and border them with lines
(<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code>). The time series of the sensitivity estimates
should also be plotted with lines. We define the fill colors and the
line colors for the first and total order sensitivities with
<code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual()</a></code>.
With <code><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs()</a></code> we give the Axes and the legend entries better
names. As we control the plot properties <code>color</code> and
<code>fill</code> with the <code>sensitivity</code> index type we give
both arguments the same name. With <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid()</a></code> we split
the plots for the different parameters we analyzed. We use
<code><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian()</a></code> to limit the plot window to the range
-0.1 and 1.1. The Sobol’ estimates have a plausible range between 0 and
1. The estimates and their confidence intervals cna however also lie
outside of these ranges. It would make the plot hard to read when we
show the entire calculated ranges. To show the smaller range but to plot
e.g. the confidence bands considering the data that lies outside of this
range we have to limit the plot canvas with
<code><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian()</a></code> instead of using e.g. <code><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim()</a></code>
or <code><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims()</a></code>. With <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous()</a></code> we define
the breaks of the y-axis. Again we use a ‘nicer’ theme and place the
legend at the bottom of the plot.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sens_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">'dotted'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">low.ci</span>, ymax <span class="op">=</span> <span class="va">high.ci</span>, fill <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">low.ci</span>, col <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.25</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">high.ci</span>, col <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.25</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">original</span>, col <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'tomato3'</span>, <span class="st">'steelblue'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'tomato3'</span>, <span class="st">'steelblue'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Date'</span>, y <span class="op">=</span> <span class="st">'First and total order sensitivity'</span>,</span>
<span>       color <span class="op">=</span> <span class="st">'Sensitivity index'</span>, fill <span class="op">=</span> <span class="st">'Sensitivity index'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span></code></pre></div>
<p>We use the <code>patchwork</code> package to ‘patch’ our two plots
together. This plot gives us a wonderful insight into the processes that
control the simulated discharge and which parameters control these
processes in their temporal sequence.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_plot</span> <span class="op">/</span> <span class="va">sens_plot</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="par_sensitivity_files/figure-html/unnamed-chunk-53-1.png" width="1056"></p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-Saltelli1999" class="csl-entry">
A. Saltelli, K. C., S. Tarantola: A quantitative model-independent
method for global sensitivity analysis of model output, Technometrics,
41(1), 39–56, doi:<a href="https://doi.org/10.1080/00401706.1999.10485594" class="external-link">10.1080/00401706.1999.10485594</a>,
1999.
</div>
<div id="ref-Iooss2018" class="csl-entry">
Iooss, B., Janon, A., Pujol, G., Khalid Boumhaout, with contributions
from, Veiga, S. D., Delage, T., Fruth, J., Gilquin, L., Guillaume, J.,
Le Gratiet, L., Lemaitre, P., Nelson, B. L., Monari, F., Oomen, R.,
Rakovec, O., Ramos, B., Roustant, O., Song, E., Staum, J., Sueur, R.,
Touati, T. and Weber, F.: Sensitivity: Global sensitivity analysis of
model outputs. [online] Available from: <a href="https://CRAN.R-project.org/package=sensitivity" class="external-link">https://CRAN.R-project.org/package=sensitivity</a>
(Accessed 5 March 2019), 2018.
</div>
<div id="ref-Jansen1999" class="csl-entry">
Jansen, M. J. W.: Analysis of variance designs for model output,
Computer Physics Communications, 117(1), 35–43, doi:<a href="https://doi.org/10.1016/S0010-4655(98)00154-4" class="external-link">https://doi.org/10.1016/S0010-4655(98)00154-4</a>,
1999.
</div>
<div id="ref-MZB2017" class="csl-entry">
Mauricio Zambrano-Bigiarini: <a href="https://doi.org/10.5281/zenodo.840087" class="external-link">hydroGOF: Goodness-of-fit
functions for comparison of simulated and observed hydrological time
series</a>., 2017.
</div>
<div id="ref-Morris1991" class="csl-entry">
Morris, M. D.: Factorial sampling plans for preliminary computational
experiments, Technometrics, 33(2), 161–174, 1991.
</div>
<div id="ref-Nash1970" class="csl-entry">
Nash, J. E. and Sutcliffe, J. V.: <span class="nocase">River flow
forecasting through conceptual models part I - A discussion of
principles</span>, Journal of Hydrology, 10(3), 282–290, doi:<a href="https://doi.org/10.1016/0022-1694(70)90255-6" class="external-link">10.1016/0022-1694(70)90255-6</a>,
1970.
</div>
<div id="ref-Puy2022" class="csl-entry">
Puy, A., Piano, S. L., Saltelli, A. and Levin, S. A.: <span class="nocase">sensobol</span>: An <span>R</span> package to compute
variance-based sensitivity indices, Journal of Statistical Software,
102(5), 1–37, doi:<a href="https://doi.org/10.18637/jss.v102.i05" class="external-link">10.18637/jss.v102.i05</a>,
2022.
</div>
<div id="ref-Rakovec2014" class="csl-entry">
Rakovec, O., Hill, M. C., Clark, M. P., Weerts, A. H., Teuling, A. J.
and Uijlenhoet, R.: <span class="nocase">Distributed Evaluation of Local
Sensitivity Analysis (DELSA), with application to hydrologic
models</span>, Water Resour. Res, 50, 409–426, doi:<a href="https://doi.org/10.1002/2013WR014063" class="external-link">10.1002/2013WR014063</a>,
2014.
</div>
<div id="ref-Razavi2016a" class="csl-entry">
Razavi, S. and Gupta, H. V.: A new framework for comprehensive, robust,
and efficient global sensitivity analysis: 1. theory, Water Resources
Research, 52(1), 423–439, doi:<a href="https://doi.org/10.1002/2015WR017558" class="external-link">10.1002/2015WR017558</a>,
2016a.
</div>
<div id="ref-Razavi2016b" class="csl-entry">
Razavi, S. and Gupta, H. V.: A new framework for comprehensive, robust,
and efficient global sensitivity analysis: 2. application, Water
Resources Research, 52(1), 440–455, doi:<a href="https://doi.org/10.1002/2015WR017559" class="external-link">https://doi.org/10.1002/2015WR017559</a>,
2016b.
</div>
<div id="ref-Sobol1993" class="csl-entry">
Sobol, I. M.: <span class="nocase">Sensitivity analysis for nonlinear
mathematical models</span>, Mathematical Modelling and Computational
Experiments, 4(1), 407–414, doi:<a href="https://doi.org/10.18287/0134-2452-2015-39-4-459-461." class="external-link">10.18287/0134-2452-2015-39-4-459-461.</a>,
1993.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/chrisschuerz" class="external-link">Christoph Schuerz</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
