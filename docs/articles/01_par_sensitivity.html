<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>01 - Parameter sensitivity analysis • SWATplusR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="01 - Parameter sensitivity analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SWATplusR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SWATplusR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_par_sensitivity.html">01 - Parameter sensitivity analysis</a>
    </li>
    <li>
      <a href="../articles/02_par_sampl_calib.html">02 - Parameter sampling and model calibration</a>
    </li>
    <li>
      <a href="../articles/03_par_optim.html">03 - Parameter optimization</a>
    </li>
    <li>
      <a href="../articles/04_vis_example.html">04 - Visualization of simulation results</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chrisschuerz/SWATplusR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>01 - Parameter sensitivity analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chrisschuerz/SWATplusR/blob/master/vignettes/01_par_sensitivity.Rmd"><code>vignettes/01_par_sensitivity.Rmd</code></a></small>
      <div class="hidden name"><code>01_par_sensitivity.Rmd</code></div>

    </div>

    
    
<div id="r-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#r-packages" class="anchor"></a>R packages</h2>
<p>Several R packages provide methods for sensitivity analysis. Two of the widely implemented packages are <code>sensitivity</code> <span class="citation">(Iooss et al., <a href="#ref-Iooss2018">2018</a>)</span> and <code>fast</code> <span class="citation">(Reusser, <a href="#ref-Reusser2015">2015</a>)</span>. <code>fast</code> provides the Fourier Amplitude Sensitivity Test (FAST) as single method for sensitivity analysis. The implementation of FAST, however, is very well suited to implement it in a workflow with <code>SWATplusR</code>. <code>sensitivity</code> is a very comprehensive collection of methods for sensitivity analysis (it actually includes the FAST method as well). The implementation in a workflow with <code>SWATplusR</code> is, however, less flexible. In this example we will use two frequently applied methods for sensitivity analysis that are provided by these two R packages, the method of Solbol <span class="citation">(<a href="#ref-Sobol1993">1993</a>)</span> provided by <code>sensitivity</code> and FAST <span class="citation">(Cukier et al., <a href="#ref-Cukier1973">1973</a>)</span> provided by <code>fast</code>. Most methods for sensitivity analysis require a scalar model result to assess the sensitivity of that output variable to changes in the inputs. Multiple goodness-of-fit functions are available from literature to evaluate simulated time series with observed time series of that variable that result in scalar values. The <code>hydroGOF</code> package <span class="citation">(Mauricio Zambrano-Bigiarini, <a href="#ref-MZB2017">2017</a>)</span> summarizes frequently used functions for the evaluation of time series of hydrological variables.</p>
<div id="package-installation" class="section level3">
<h3 class="hasAnchor">
<a href="#package-installation" class="anchor"></a>Package installation</h3>
<p>If you do not have installed any of the required R package, follow the instructions for the respective R package. All of the required R packages are available from CRAN and can be installed with the following commands:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"dplyr"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"fast"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"forcats"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"ggplot2"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"hydroGOF"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"sensitivity"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"tidyr"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"purrr"</span>)</code></pre></div>
</div>
<div id="loading-r-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-r-packages" class="anchor"></a>Loading R packages</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fast)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(forcats)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(hydroGOF)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(SWATplusR)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sensitivity)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)</code></pre></div>
</div>
</div>
<div id="loading-demo-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-demo-data" class="anchor"></a>Loading demo data</h2>
<p>The sensitivity analysis example uses the SWAT+ demo project available from <code>SWATplusR</code>. The demo project is a simple model setup of a head watershed of the Little River Experimental Watershed <span class="citation">(LREW; Bosch et al., <a href="#ref-Bosch2007">2007</a>)</span>. You can load the to your hard drive as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The path where the SWAT demo project will be written</span>
demo_path &lt;-<span class="st"> "Define:/your/path"</span>

<span class="co"># Loading the SWAT+ demo project on your hard drive</span>
path_plus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_demo.html">load_demo</a></span>(<span class="dt">dataset =</span> <span class="st">"project"</span>,
                       <span class="dt">version =</span> <span class="st">"plus"</span>,
                       <span class="dt">path =</span> demo_path,
                       <span class="dt">revision =</span> <span class="dv">57</span>)</code></pre></div>
<p><code>SWATplusR</code> also provides observation data of daily discharge records at the main outlet of the demo for the time period 1968-01-01 until 2012-12-31. We will use the observation data to evaluate the model in each optimization step. The model will be evaluated for the time period 2003-01-01 to 2007-12-31. Therefore, we load the demo data and limit it to this time period:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q_obs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_demo.html">load_demo</a></span>(<span class="dt">dataset =</span> <span class="st">"observation"</span>)

q_obs &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(q_obs, date <span class="op">&gt;=</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2003-01-01"</span>),
                       date <span class="op">&lt;=</span><span class="st"> "2007-12-31"</span>)</code></pre></div>
</div>
<div id="model-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#model-parameters" class="anchor"></a>Model parameters</h2>
<p>In the sensitivity analyses we will use 7 parameters that are frequently used for model calibration with respect to simulated discharge. In a first step we define the parameter names as these control the parameter alteration in the <code>run_swat*()</code> functions. If you want to learn in detai how to define the parameter names correctly see the <a href="https://chrisschuerz.github.io/SWATplusR/articles/SWATplusR.html#model-parameter-alteration">Get started</a> section on ‘Model parameter alteration’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">par_names &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"cn2.hru | change = abschg"</span>,
               <span class="st">"lat_ttime.hru | change = absval"</span>,
               <span class="st">"lat_len.hru | change = absval"</span>,
               <span class="st">"k.sol | change = pctchg"</span>,
               <span class="st">"z.sol | change = pctchg"</span>,
               <span class="st">"esco.hru | change = absval"</span>,
               <span class="st">"epco.hru | change = absval"</span>)</code></pre></div>
</div>
<div id="sensitivity-analysis-with-fast" class="section level2">
<h2 class="hasAnchor">
<a href="#sensitivity-analysis-with-fast" class="anchor"></a>Sensitivity analysis with <code>fast</code>
</h2>
<div id="parameter-sampling" class="section level3">
<h3 class="hasAnchor">
<a href="#parameter-sampling" class="anchor"></a>Parameter sampling</h3>
<p>The Fourier Amplitude Sensitivity Test (FAST) is a method to perform GSA with few model evaluations. It only requires a few simulations when the number of parameters is low and strongly increases to tenth of thousands of model evaluations for more than 20 parameters. To keep the number of model evaluations low we use the 7 selected parameters above.</p>
<p>The FAST method requires a specific parameter sampling design, that is available in <code>fast</code> with the function <code><a href="https://www.rdocumentation.org/packages/fast/topics/fast_parameters">fast_parameters()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">par_fast &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/fast/topics/fast_parameters">fast_parameters</a></span>(
  <span class="dt">minimum =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">15</span>, <span class="fl">0.5</span>,  <span class="dv">10</span>, <span class="op">-</span><span class="dv">50</span>, <span class="op">-</span><span class="dv">50</span>, <span class="dv">0</span>,  <span class="dv">0</span>),
  <span class="dt">maximum =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>( <span class="dv">10</span>,  <span class="dv">50</span>, <span class="dv">100</span>,  <span class="dv">50</span>,  <span class="dv">50</span>, <span class="dv">1</span>,  <span class="dv">1</span>),
    <span class="dt">names =</span> par_names) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>()

par_fast
<span class="co">#&gt; # A tibble: 167 x 7</span>
<span class="co">#&gt;    `cn2.hru | chan… `lat_ttime.hru … `lat_len.hru | … `k.sol | change…</span>
<span class="co">#&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1          -13.8              44.3              84.3           -29.5 </span>
<span class="co">#&gt;  2          -11.2              32.7              52.3            12.0 </span>
<span class="co">#&gt;  3           -8.67             21.1              20.3            47.0 </span>
<span class="co">#&gt;  4           -6.11              9.45             31.1             5.42</span>
<span class="co">#&gt;  5           -3.55              2.89             63.1           -36.1 </span>
<span class="co">#&gt;  6           -0.994            14.5              95.1           -22.9 </span>
<span class="co">#&gt;  7            1.57             26.1              73.4            18.7 </span>
<span class="co">#&gt;  8            4.13             37.8              41.4            40.4 </span>
<span class="co">#&gt;  9            6.69             49.4              10              -1.20</span>
<span class="co">#&gt; 10            9.25             39.3              42.0           -42.8 </span>
<span class="co">#&gt; # … with 157 more rows, and 3 more variables: `z.sol | change =</span>
<span class="co">#&gt; #   pctchg` &lt;dbl&gt;, `esco.hru | change = absval` &lt;dbl&gt;, `epco.hru | change</span>
<span class="co">#&gt; #   = absval` &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="model-simulation-and-evaluation" class="section level3">
<h3 class="hasAnchor">
<a href="#model-simulation-and-evaluation" class="anchor"></a>Model simulation and evaluation</h3>
<p>To perform a FAST analysis for 7 parameters 167 model evaluations are required. We implement the sampled FAST parameter combinations in the SWAT+ demo project by passing the parameter table with the argument <code>parameter</code> in the <code>run_swaplus()</code> function. We will perform the sensitivity analysis for the simulation period 2003-01-01 to 2007-12-31 (to accord with the simulation workflow of the tutorial on <a href="https://chrisschuerz.github.io/SWATplusR/articles/par_sampl_calib.html">Parameter sampling an model calibration</a>, as sensitivity analysis is often followed by the model calibration).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q_fast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_swatplus.html">run_swatplus</a></span>(<span class="dt">project_path =</span> path_plus,
            <span class="dt">output =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">q_sim =</span> <span class="kw"><a href="../reference/define_output.html">define_output</a></span>(<span class="dt">file =</span> <span class="st">"channel"</span>,
                                  <span class="dt">variable =</span> <span class="st">"flo_out"</span>,
                                  <span class="dt">unit =</span> <span class="dv">3</span>)),
            <span class="dt">parameter =</span> par_fast,
            <span class="dt">start_date =</span> <span class="st">"2000-01-01"</span>,
            <span class="dt">end_date =</span> <span class="st">"2007-12-31"</span>,
            <span class="dt">years_skip =</span> <span class="dv">3</span>,
            <span class="dt">n_thread =</span> <span class="dv">4</span>)

<span class="co">#&gt; Building 4 threads in 'C:/swatplus_demo/.model_run':</span>
<span class="co">#&gt;  Completed 4 threads in 0S</span>
<span class="co">#&gt; Performing 167 simulations on 4 cores:</span>
<span class="co">#&gt;  Completed 167 simulations in 1M 18S</span></code></pre></div>
<p>The model runs that used the parameter sets sampled with <code>fast</code> are evaluated using the NSE <span class="citation">(Nash and Sutcliffe, <a href="#ref-Nash1970">1970</a>)</span> criterion for daily discharge for the time period 2003 to 2012.</p>
<p>The <code><a href="https://www.rdocumentation.org/packages/hydroGOF/topics/NSE">NSE()</a></code> function is available from the <code>hydroGOF</code> package. The simulations are evaluated with the daily observations of discharge for the period 2003 to 2007. The calculated NSE values can than be used to assess the sensitivity of the NSE to changes in parameter values with the function <code><a href="https://www.rdocumentation.org/packages/fast/topics/sensitivity">sensitivity()</a></code> from the <code>fast</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nse_fast &lt;-<span class="st"> </span>q_fast<span class="op">$</span>simulation<span class="op">$</span>q_sim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(., <span class="op">~</span><span class="kw"><a href="https://www.rdocumentation.org/packages/hydroGOF/topics/NSE">NSE</a></span>(.x<span class="op">/</span><span class="fl">8.64</span>, q_obs<span class="op">$</span>discharge))

sens_fast &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/fast/topics/sensitivity">sensitivity</a></span>(nse_fast, <span class="dv">7</span>)</code></pre></div>
</div>
<div id="visualization-of-the-fast-sensitivities" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-of-the-fast-sensitivities" class="anchor"></a>Visualization of the FAST sensitivities</h3>
<p>To visualize the calculated sensitivities we first arrange the results in a <code>tibble</code> <span class="citation">(Müller and Wickham, <a href="#ref-Mueller2019">2019</a>)</span>. It is a good idea to rank the parameters in the plot of their sensitivities. Therefore, we convert the parameter names to factors and sort them according to their sensitivity results using the functionality of the <code>forcats</code> package <span class="citation">(Wickham, <a href="#ref-Wickham2019a">2019</a>)</span>. We plot the parameter ranking in a barplot using <code>ggplot2</code> <span class="citation">(Wickham, <a href="#ref-Wickham2016">2016</a>)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result_fast &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">parameter =</span> q_fast<span class="op">$</span>parameter<span class="op">$</span>definition<span class="op">$</span>par_name,
                      <span class="dt">fast      =</span> sens_fast) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">parameter =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(parameter) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span>(., fast))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> result_fast) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> parameter, <span class="dt">y =</span> fast)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Parameter"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Sensitivity"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</code></pre></div>
<p><img src="01_par_sensitivity_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
<div id="sensitivity-analysis-with-the-method-of-sobol" class="section level2">
<h2 class="hasAnchor">
<a href="#sensitivity-analysis-with-the-method-of-sobol" class="anchor"></a>Sensitivity analysis with the method of Sobol</h2>
<p>The method of Sobol is a reference method for GSA. To implement the SWAT model in the GSA workflow with <code>sensitivity</code> a function has to be defined that returns the a scalar variable for which the sensitivity is assessed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">swat_sobol &lt;-<span class="st"> </span><span class="cf">function</span>(par, obs) {
  q_sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_swatplus.html">run_swatplus</a></span>(<span class="dt">project_path =</span> proj_path,
                        <span class="dt">output =</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">q_sim =</span> <span class="kw"><a href="../reference/define_output.html">define_output</a></span>(<span class="dt">file =</span> <span class="st">"channel"</span>,
                                     <span class="dt">variable =</span> <span class="st">"flo_out"</span>,
                                     <span class="dt">unit =</span> <span class="dv">1</span>)),
                        <span class="dt">parameter =</span> par,
                        <span class="dt">start_date =</span> <span class="st">"2000-01-01"</span>,
                        <span class="dt">end_date =</span> <span class="st">"2007-12-31"</span>,
                        <span class="dt">years_skip =</span> <span class="dv">3</span>, <span class="dt">n_thread =</span> <span class="dv">4</span>,
                        <span class="dt">add_date =</span> <span class="ot">FALSE</span>)
  nse_q &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(q_sim<span class="op">$</span>simulation<span class="op">$</span>q_sim<span class="op">/</span><span class="fl">8.64</span>, <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/hydroGOF/topics/NSE">NSE</a></span>(.x, obs))
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(nse_q)
}</code></pre></div>
<p>To perform GSA with the method of Sobol two random sets of samples with the same sample size for the parameters that should be analyzed are required.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">par_bound &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="st">"cn2.hru | change = abschg"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">15</span>, <span class="dv">10</span>),
                    <span class="st">"lat_ttime.hru | change = absval"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="dv">50</span>),
                    <span class="st">"lat_len.hru | change = absval"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>, <span class="dv">100</span>),
                    <span class="st">"k.sol | change = pctchg"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">50</span>, <span class="dv">50</span>),
                    <span class="st">"z.sol | change = pctchg"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">50</span>, <span class="dv">50</span>),
                    <span class="st">"esco.hru | change = absval"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>),
                    <span class="st">"epco.hru | change = absval"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>))
n_par  &lt;-<span class="st"> </span><span class="dv">7</span>
n_samp &lt;-<span class="st"> </span><span class="dv">500</span>
x1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n_par <span class="op">*</span><span class="st"> </span>n_samp), <span class="dt">nrow =</span> n_samp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span>(., <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(par_bound)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2_dfc</a></span>(., par_bound, <span class="op">~</span><span class="st"> </span>(.x <span class="op">*</span><span class="st"> </span>(.y[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>.y[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span>.y[<span class="dv">1</span>]))
x2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n_par <span class="op">*</span><span class="st"> </span>n_samp), <span class="dt">nrow =</span> n_samp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span>(., <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(par_bound)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2_dfc</a></span>(., par_bound, <span class="op">~</span><span class="st"> </span>(.x <span class="op">*</span><span class="st"> </span>(.y[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>.y[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span>.y[<span class="dv">1</span>]))</code></pre></div>
<p>To perform the sensitivity analysis with using method of Sobol the following command has to be executed. In total 4000 model evaluations are necessary to analyze 7 parameters with 500 Sobol samples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sens_sobol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sensitivity/topics/sobol">sobol</a></span>(<span class="dt">model =</span> swat_nse, <span class="dt">X1 =</span> x1, <span class="dt">X2 =</span> x2, 
                    <span class="dt">obs =</span> q_obs<span class="op">$</span>discharge, <span class="dt">nboot =</span> <span class="dv">100</span>)</code></pre></div>
<div id="visualization-of-the-sobol-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-of-the-sobol-analysis" class="anchor"></a>Visualization of the Sobol analysis</h3>
<p>Similar to the visualization of the results with the FAST method the results of the GSA with the method of Solbol are plotted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_sobol &lt;-<span class="st"> </span>sens_sobol<span class="op">$</span>S <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">parameter =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(.)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">parameter =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(parameter) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span>(., original))
<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> plot_sobol) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_pointrange</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> parameter, <span class="dt">y =</span> original ,
                      <span class="dt">ymin =</span> <span class="st">`</span><span class="dt">min. c.i.</span><span class="st">`</span>, <span class="dt">ymax =</span> <span class="st">`</span><span class="dt">max. c.i.</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Parameter"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Sensitivity"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</code></pre></div>
<p><img src="01_par_sensitivity_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Bosch2007">
<p>Bosch, D. D., Sheridan, J. M., Lowrance, R. R., Hubbard, R. K., Strickland, T. C., Feyereisen, G. W. and Sullivan, D. G.: Little river experimental watershed database, Water Resources Research, 43(9), doi:<a href="https://doi.org/10.1029/2006wr005844">10.1029/2006wr005844</a>, 2007.</p>
</div>
<div id="ref-Cukier1973">
<p>Cukier, R. I., Fortuin, C. M., Shuler, K. E., Petschek, A. G. and Schaibly, J. H.: Study of the sensitivity of coupled reaction systems to uncertainties in rate coefficients. i theory, The Journal of Chemical Physics, 59(8), 3873–3878, doi:<a href="https://doi.org/10.1063/1.1680571">10.1063/1.1680571</a>, 1973.</p>
</div>
<div id="ref-Iooss2018">
<p>Iooss, B., Janon, A., Pujol, G., Khalid Boumhaout, Veiga, S. D., Delage, T., Fruth, J., Gilquin, L., Guillaume, J., Le Gratiet, L., Lemaitre, P., Nelson, B. L., Monari, F., Oomen, R., Rakovec, O., Ramos, B., Roustant, O., Song, E., Staum, J., Sueur, R., Touati, T. and Weber, F.: Sensitivity: Global sensitivity analysis of model outputs. [online] Available from: <a href="https://CRAN.R-project.org/package=sensitivity" class="uri">https://CRAN.R-project.org/package=sensitivity</a> (Accessed 5 March 2019), 2018.</p>
</div>
<div id="ref-MZB2017">
<p>Mauricio Zambrano-Bigiarini: HydroGOF: Goodness-of-fit functions for comparison of simulated and observed hydrological time series., 2017.</p>
</div>
<div id="ref-Mueller2019">
<p>Müller, K. and Wickham, H.: Tibble: Simple data frames. [online] Available from: <a href="https://CRAN.R-project.org/package=tibble" class="uri">https://CRAN.R-project.org/package=tibble</a> (Accessed 5 March 2019), 2019.</p>
</div>
<div id="ref-Nash1970">
<p>Nash, J. E. and Sutcliffe, J. V.: River flow forecasting through conceptual models part I - A discussion of principles, Journal of Hydrology, 10(3), 282–290, doi:<a href="https://doi.org/10.1016/0022-1694(70)90255-6">10.1016/0022-1694(70)90255-6</a>, 1970.</p>
</div>
<div id="ref-Reusser2015">
<p>Reusser, D.: Fast: Implementation of the fourier amplitude sensitivity test (fast). [online] Available from: <a href="https://CRAN.R-project.org/package=fast" class="uri">https://CRAN.R-project.org/package=fast</a> (Accessed 5 March 2019), 2015.</p>
</div>
<div id="ref-Sobol1993">
<p>Sobol, I. M.: Sensitivity analysis for nonlinear mathematical models, Mathematical Modelling and Computational Experiments, 4(1), 407–414, doi:<a href="https://doi.org/10.18287/0134-2452-2015-39-4-459-461.">10.18287/0134-2452-2015-39-4-459-461.</a>, 1993.</p>
</div>
<div id="ref-Wickham2016">
<p>Wickham, H.: ggplot2: Elegant Graphics for Data Analysis, Springer-Verlag New York. [online] Available from: <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>, 2016.</p>
</div>
<div id="ref-Wickham2019a">
<p>Wickham, H.: Forcats: Tools for working with categorical variables (factors). [online] Available from: <a href="https://CRAN.R-project.org/package=forcats" class="uri">https://CRAN.R-project.org/package=forcats</a> (Accessed 5 March 2019), 2019.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#r-packages">R packages</a></li>
      <li><a href="#loading-demo-data">Loading demo data</a></li>
      <li><a href="#model-parameters">Model parameters</a></li>
      <li><a href="#sensitivity-analysis-with-fast">Sensitivity analysis with <code>fast</code></a></li>
      <li><a href="#sensitivity-analysis-with-the-method-of-sobol">Sensitivity analysis with the method of Sobol</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Christoph Schuerz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
