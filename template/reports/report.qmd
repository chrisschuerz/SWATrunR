---
title: "Model crop calibration results for CS4"
subtitle: "Report for model performance"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    embed-resources: true
    smooth-scroll: true
    toc: true
    toc-location: left
    toc-title: Summary
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    theme: cosmo
    fontcolor: black
---

## ET figure

```{r}
#| echo: FALSE
d <- summary(et_df$et)
t_d <- data.frame(unclass(d), check.names = FALSE, stringsAsFactors = FALSE) %>% t %>% `rownames<-`("summary") %>% round(.,1)
datatable(t(t_d))
```

```{r}
#| out-width: '100%'
#| echo: FALSE

print(et_fig)
```

## Plant processes

### Stress level

```{r}
#| out-width: '100%'
#| echo: FALSE

plot_variable_at_harvkill(sim0, variable = 'stress')
```


### Yields

```{r}
#| out-width: '100%'
#| echo: FALSE

sim_list <- list(no_stress = sim1, except_nutrient = sim2, all_stress = sim0)
plot_variable_at_harvkill(sim_list, variable = 'yield')
rm(sim_list)
```

### PHUs

```{r}
#| out-width: '100%'
#| echo: FALSE

plot_variable_at_harvkill(sim0, variable = 'phu')
```

### Biomass and LAI change random 3 first HRUs **no stress**

```{r}
#| out-width: '100%'
#| echo: FALSE

plot_hru_pw_day(sim1, hru_id = c(1:3), var = c('lai', 'bioms'), add_crop = TRUE)
```
### Biomass and LAI change random 3 first HRUs **nutrient stress**

```{r}
#| out-width: '100%'
#| echo: FALSE

plot_hru_pw_day(sim2, hru_id = c(1:3), var = c('lai', 'bioms'), add_crop = TRUE)
```

### Biomass and LAI change random 3 first HRUs **all stress**

```{r}
#| out-width: '100%'
#| echo: FALSE

plot_hru_pw_day(sim0, hru_id = c(1:3), var = c('lai', 'bioms'), add_crop = TRUE)
```

## Crop yield figures

```{r}
#| echo: FALSE
datatable(df[,c("crop","yield")] %>% 
  group_by(crop) %>% 
  summarize(`Min.` = min(yield), 
            `1rd Qu.` = quantile(yield, 0.25), 
            Median = median(yield), 
            Mean = mean(yield),
            `3rd Qu.` = quantile(yield, 0.75), 
            `Max.` = max(yield)) %>% 
  left_join(crops_obs, by = 'crop') %>% 
  rename(`Obs. yield kg/y`= value) %>% 
  mutate(`PBIAS` = (Median/`Obs. yield kg/y`-1)*100) %>% 
  mutate_if(is.numeric, ~round(.,2)))
```

```{r}
#| echo: FALSE
#| results: asis
#| out-width: '100%'
#| fig-height: 5

for(f in names(crop_figs)){
  cat("  \n###", f, " plots \n")
  print(crop_figs[[f]])
  cat("  \n")
}
```

## Settings.R values

These settings were used in running scripts and preparing report.

```{r}
#| echo: FALSE
print(paste0("SWAT model used in calculation: ", swat_file))
source("../settings.R", echo = TRUE, local = knitr::knit_global(), max.deparse.length=9999)

```
